<!doctype html>
<html>
  <head>
    <title>Socket.IO</title>
    <style>
    </style>
    <script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1mZxTqmVQQh--Xqjd_fuRQPrrSMpLkE8"></script>
    <script>
      $(function(){
        var latlng = new google.maps.LatLng(32.43, 130.3305);
        var opts = {
          zoom: 13,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"), opts);

        var modules = {};

        var socket = io();
        socket.on("position", function(data){
          //console.log(data);
          var li = $("<li>").text(JSON.stringify(data));
          $("#messages").prepend(li);

          var id = data.module;
          var latlng = new google.maps.LatLng(data.latitude, data.longitude);
          console.log(data.latitude, data.longitude);

          if(!modules[data.module]){
            var marker = new google.maps.Marker({
              position: latlng,
              map: map
            });
            var line = new google.maps.Polyline({
                path: [],
                strokeWeight: 5,
                strokeColor: "#0000ff",
                strokeOpacity: "0.5"
            });
            line.setMap(map);
            modules[data.module] = {
              marker: marker,
              line: line
            };
          }

          modules[data.module].marker.setOptions({position: latlng});
          modules[data.module].line.getPath().push(latlng);
        });
      });
    </script>
  </head>
  <body>

    <div id="map_canvas" style="width:100%; height:400px"></div>

    <ul id="messages">
    </ul>
  </body>
</html>
